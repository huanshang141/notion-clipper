# Notion Clipper - 完整测试计划

## 概述

本测试计划涵盖Notion Clipper扩展程序的所有主要功能，确保从内容提取到Notion保存的完整流程正常运行。

## 环境设置

### 前置条件

1. Notion账户和一个用于测试的工作区
2. 创建一个Notion Internal Integration Token
   - 访问 https://www.notion.so/my-integrations
   - 创建新集成
   - 复制API Key（格式：`ntn_` + ~50个字符）
3. 创建测试数据库
   - 创建一个包含多种字段类型的数据库（参见下方模板）

### Notion测试数据库模板

```
字段名称           字段类型          用途
Title             Title            文章标题 (必需)
URL               URL              原始文章链接
Content           Rich Text         文章正文内容
Excerpt           Rich Text         文章摘要/描述
Domain            Text             来源网站域名
ReadingTime       Number           预计阅读时间（分钟）
Published Date    Date             文章发布日期
Tags              Multi-select     文章标签
Category          Select           文章分类
Cover Image       Files            封面图片
Saved Date        Date             保存日期
```

## 第一阶段：认证测试

### 测试1.1：API密钥验证

**目标**：验证API密钥格式和有效性检查

**步骤**：

1. 打开扩展程序弹窗
2. 输入无效的API密钥（缺少"ntn\_"前缀）
   - 验证错误提示
   - 验证"连接"按钮被禁用
3. 输入正确格式但无效的API密钥
   - 预期：显示认证失败消息
4. 输入有效的API密钥
   - 预期：成功认证，弹窗显示保存表单

**预期结果**：

- ✅ 格式验证正常工作
- ✅ 无效密钥拒绝
- ✅ 有效密钥成功认证

### 测试1.2：认证状态持久化

**目标**：验证认证token正确存储和恢复

**步骤**：

1. 成功认证后，关闭并重新打开扩展程序
2. 验证无需重新输入就显示保存表单
3. 点击登出按钮
4. 再次打开扩展程序，验证返回登录表单

**预期结果**：

- ✅ Token在chrome.storage中持久化
- ✅ 登出清除token

---

## 第二阶段：内容提取测试

### 测试2.1：基本内容提取

**目标**：验证Readability正确提取页面内容

**步骤**：

1. 导航到一个有标准文章内容的网页（如Medium、Dev.to等）
2. 打开扩展程序
3. 验证以下内容被提取：
   - ✅ 文章标题
   - ✅ 文章主体内容（Markdown格式）
   - ✅ URL
   - ✅ 域名
   - ✅ 摘要/描述

**测试页面建议**：

- https://www.example.com
- https://github.blog
- https://dev.to/

### 测试2.2：元数据提取

**目标**：验证发布日期、作者、OG图片信息的提取

**步骤**：

1. 在包含以下元标记的页面上测试：
   - `og:image` / `twitter:image`
   - `article:published_time`
   - `article:author`
2. 验证提取的元数据

**预期结果**：

- ✅ 主图片正确识别
- ✅ 发布日期被提取
- ✅ 作者信息（如果可用）被提取

### 测试2.3：图片提取

**目标**：验证页面内所有图片被识别

**步骤**：

1. 在包含多个图片的页面上测试
2. 验证弹窗显示图片加载状态
3. 完成保存并验证图片被包含

**预期结果**：

- ✅ 所有图片被检测（最多20张）
- ✅ 主图片优先级正确（OG > Twitter > 最大）

---

## 第三阶段：字段映射测试

### 测试3.1：自动字段检测

**目标**：验证字段自动映射到数据库属性

**步骤**：

1. 认证后，选择测试数据库
2. 观察SaveForm中的"Fields to Save"部分
3. 验证以下字段被正确映射：
   - Title → 标题字段
   - Content → Content字段
   - URL → URL字段
   - mainImage → Cover Image字段
   - excerpt → Excerpt字段

**预期结果**：

- ✅ 自动检测映射准确性高
- ✅ 每个字段显示源字段和类型
- ✅ 未映射的字段显示为灰色

### 测试3.2：字段类型转换

**目标**：验证不同Notion字段类型的值正确构建

**步骤**：
对每个字段类型测试值构建逻辑：

**Title字段**：

- 输入：article.title
- 验证：生成正确的title属性结构
- 预期：`{ title: [{ type: 'text', text: { content: '...' } }] }`

**Rich Text/Text字段**：

- 输入：article.content, article.excerpt
- 验证：长度限制（2000字符）
- 预期：markdown内容被正确转换

**URL字段**：

- 输入：article.url
- 验证：格式验证（必须以http/https开头）
- 预期：`{ url: 'https://...' }`

**Files字段**：

- 输入：article.mainImage
- 验证：文件URL格式
- 预期：`{ files: [{ name: 'image', type: 'external', external: { url: '...' } }] }`

**Date字段**：

- 输入：article.publishedDate
- 验证：格式验证（YYYY-MM-DD）
- 预期：`{ date: { start: '2024-01-15' } }`

**Select/Multi-select字段**：

- 输入：字符串或数组
- 验证：名称长度限制（100字符）
- 预期：Select：`{ select: { name: 'Category' } }`，Multi-select：`{ multi_select: [{ name: 'tag1' }, ...] }`

**Checkbox字段**：

- 输入：任何值
- 验证：转换为布尔值
- 预期：`{ checkbox: true/false }`

**Number字段**：

- 输入：数字字符串
- 验证：解析和验证为数字
- 预期：`{ number: 42 }`

**Email字段**：

- 输入：email字符串
- 验证：包含@符号
- 预期：`{ email: 'test@example.com' }`

**Phone Number字段**：

- 输入：电话字符串
- 验证：保留原始格式
- 预期：`{ phone_number: '+1-555-1234' }`

---

## 第四阶段：保存到Notion测试

### 测试4.1：页面创建

**目标**：验证页面在Notion中成功创建

**步骤**：

1. 完成内容提取和字段映射
2. 点击"Save to Notion"按钮
3. 等待保存完成
4. 验证：
   - ✅ 成功提示显示并包含Notion链接
   - ✅ 页面在Notion中可见
   - ✅ 所有字段值正确

### 测试4.2：字段值准确性

**目标**：验证保存到Notion的值准确反映提取的内容

**步骤**：

1. 保存文章后在Notion中打开页面
2. 验证每个字段的值：
   - Title：与提取的标题匹配
   - URL：可点击并正确
   - Content：Markdown格式正确
   - Date：正确解析

**预期结果**：

- ✅ 所有字段值准确
- ✅ Markdown格式在Rich Text中正确显示
- ✅ 日期格式有效

### 测试4.3：块内容（Block Content）

**目标**：验证文章内容以块的形式添加

**步骤**：

1. 保存文章
2. 在Notion中查看页面
3. 验证：
   - ✅ 文章内容显示为段落块
   - ✅ 最多20个内容块被添加（避免API限制）
   - ✅ 图片显示为图片块

**预期结果**：

- ✅ 内容块格式正确
- ✅ 块数量在限制内

### 测试4.4：速率限制处理

**目标**：验证速率限制上升并正确处理

**步骤**：

1. 快速保存多个文章（10+个）
2. 观察速率限制行为
3. 验证显示适当的错误消息

**预期结果**：

- ✅ 显示"API速率限制"错误消息
- ✅ 用户被告知稍后重试

---

## 第五阶段：图片处理测试

### 测试5.1：图片下载

**目标**：验证图片正确下载和处理

**步骤**：

1. 在包含多个图片的页面上测试
2. 观察图片下载进度
3. 验证同时最多3个并发下载
4. 观察以下情况的处理：
   - ✅ 有效的HTTP图片URL
   - ✅ 相对URL（应转换为绝对）
   - ✅ 损坏的图片链接（应跳过）
   - ✅ 大于5MB的图片（应拒绝）
   - ✅ 超时URL（15秒限制）

**预期结果**：

- ✅ 有效图片被下载
- ✅ 无效/超大图片被跳过，不影响整体流程
- ✅ 并发控制正常工作

### 测试5.2：图片上传到Notion

**目标**：验证图片被正确添加到Notion页面

**步骤**：

1. 保存包含图片的文章
2. 在Notion中验证：
   - ✅ 主图片作为Cover显示
   - ✅ 额外图片显示为块内容
   - ✅ 图片可以正常加载

**预期结果**：

- ✅ 所有可用图片显示在Notion中
- ✅ 图片加载无损坏

---

## 第六阶段：错误处理和边界情况测试

### 测试6.1：无效API密钥

**目标**：验证无效密钥被正确处理

**步骤**：

1. 输入格式正确但无效的API密钥
2. 点击连接
3. 验证显示"认证失败"错误
4. 验证可以重新输入密钥重试

### 测试6.2：网络错误

**目标**：验证网络故障被正确处理

**步骤**：

1. 断开互联网连接
2. 尝试保存文章
3. 验证显示网络错误消息
4. 恢复连接并重试

### 测试6.3：空白页面

**目标**：验证处理无法提取内容的页面

**步骤**：

1. 打开JavaScript应用程序或Single Page App
2. 打开扩展程序
3. 验证处理方式（应显示无内容消息或尽力提取）

### 测试6.4：不支持的字段类型

**目标**：验证未映射的字段类型被正确跳过

**步骤**：

1. 创建包含不常见字段类型的数据库（如Relation、Rollup）
2. 尝试保存
3. 验证未映射的字段被跳过，页面仍被创建

### 测试6.5：超短内容

**目标**：验证处理短文章

**步骤**：

1. 打开只有几个句子的页面
2. 保存到Notion
3. 验证所有可用数据都被保存

### 测试6.6：超长标题和内容

**目标**：验证长度限制正确应用

**步骤**：

1. 打开包含超长标题（>200字符）的页面
2. 保存到Notion
3. 验证标题被截断为2000字符限制
4. 验证内容也被适当截断

---

## 第七阶段：集成和UI测试

### 测试7.1：弹窗UI完整性

**目标**：验证所有UI元素正确显示和交互

**步骤**：

1. 打开扩展程序，验证弹窗尺寸
   - 预期宽度：500px
   - 预期高度：400-600px
2. 验证所有按钮可点击
3. 验证加载状态正确显示
4. 验证错误消息格式正确

### 测试7.2：数据库选择

**目标**：验证数据库列表加载和选择

**步骤**：

1. 认证后验证数据库列表加载
2. 更改数据库选择
3. 验证架构重新加载
4. 验证字段映射更新

### 测试7.3：表单状态管理

**目标**：验证表单状态在各操作期间保持正确

**步骤**：

1. 在保存期间尝试更改数据库
   - 预期：按钮被禁用
2. 验证保存完成后表单重置
3. 验证新文章被提取

### 测试7.4：登出流程

**目标**：验证登出完全清除会话

**步骤**：

1. 认证后点击登出（⊗ 按钮）
2. 验证返回登录表单
3. 验证Token被清除
4. 验证可以使用新Token重新认证

---

## 第八阶段：性能和稳定性测试

### 测试8.1：大型文章处理

**目标**：验证处理大型文章（>10000字）

**步骤**：

1. 打开包含大量内容的页面
2. 观察提取和保存性能
3. 验证没有超时或UI冻结
4. 验证块限制（20块）被应用

### 测试8.2：多个图片处理

**目标**：验证处理包含20+图片的页面

**步骤**：

1. 打开图片密集的页面
2. 保存到Notion
3. 验证：
   - 下载在并发限制内
   - 图片限制应用（最多10张块）
   - 性能仍然可接受

### 测试8.3：快速连贯操作

**目标**：验证快速连续使用扩展

**步骤**：

1. 在多个标签页上快速打开扩展
2. 快速保存多个文章
3. 验证没有冲突或数据丢失

---

## 测试覆盖矩阵

| 功能模块   | 测试用例                | 状态 | 备注 |
| ---------- | ----------------------- | ---- | ---- |
| 认证       | API密钥验证             | ⬜   |      |
|            | Token持久化             | ⬜   |      |
| 内容提取   | Readability             | ⬜   |      |
|            | 元数据提取              | ⬜   |      |
|            | 图片检测                | ⬜   |      |
| 字段映射   | 自动检测                | ⬜   |      |
|            | Title类型               | ⬜   |      |
|            | Text/Rich Text类型      | ⬜   |      |
|            | URL类型                 | ⬜   |      |
|            | Files类型               | ⬜   |      |
|            | Date类型                | ⬜   |      |
|            | Select/Multi-select类型 | ⬜   |      |
|            | Checkbox类型            | ⬜   |      |
|            | Number类型              | ⬜   |      |
|            | Email类型               | ⬜   |      |
|            | Phone Number类型        | ⬜   |      |
| Notion保存 | 页面创建                | ⬜   |      |
|            | 字段值准确性            | ⬜   |      |
|            | 块内容                  | ⬜   |      |
|            | 速率限制                | ⬜   |      |
| 图片处理   | 下载                    | ⬜   |      |
|            | 并发控制                | ⬜   |      |
|            | 上传                    | ⬜   |      |
| 错误处理   | 无效密钥                | ⬜   |      |
|            | 网络错误                | ⬜   |      |
|            | 空白页面                | ⬜   |      |
|            | 不支持的字段            | ⬜   |      |
|            | 长度限制                | ⬜   |      |
| UI/UX      | 弹窗显示                | ⬜   |      |
|            | 数据库选择              | ⬜   |      |
|            | 表单状态                | ⬜   |      |
|            | 消息显示                | ⬜   |      |
| 性能       | 大型文章                | ⬜   |      |
|            | 多个图片                | ⬜   |      |
|            | 并发操作                | ⬜   |      |

---

## 测试结果报告

### 成功标准

- ✅ 所有第1-4阶段测试合格（必需）
- ✅ 所有第5-6阶段测试合格（推荐）
- ✅ 性能测试无严重问题

### 故障报告

如发现问题，请记录：

1. 测试标题和编号
2. 复现步骤
3. 预期结果
4. 实际结果
5. 附屏幕截图
6. 严重级别（Critical/High/Medium/Low）

---

## 首次手动测试检查清单

- [ ] 扩展程序成功加载
- [ ] 认证成功
- [ ] 从Web页面提取内容
- [ ] 字段自动映射正确
- [ ] 页面成功保存到Notion
- [ ] 所有数据字段在Notion中可见
- [ ] 图片正确显示
- [ ] 点击Notion链接打开保存的页面
- [ ] 登出工作正常
- [ ] 重新认证工作正常
